- en: Journalling
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://pymupdf.readthedocs.io/en/latest/recipes-journalling.html](https://pymupdf.readthedocs.io/en/latest/recipes-journalling.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Starting with version 1.19.0, journalling is possible when updating PDF documents.
  prefs: []
  type: TYPE_NORMAL
- en: Journalling is a logging mechanism which permits either **reverting** or **re-applying**
    changes to a PDF. Similar to LUWs “Logical Units of Work” in modern database systems,
    one can group a set of updates into an “operation”. In MuPDF journalling, an operation
    plays the role of a LUW.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs: []
  type: TYPE_NORMAL
- en: 'In contrast to LUW implementations found in database systems, MuPDF journalling
    happens on a **per document level**. There is no support for simultaneous updates
    across multiple PDFs: one would have to establish one’s own logic here.'
  prefs: []
  type: TYPE_NORMAL
- en: Journalling must be *enabled* via a document method. Journalling is possible
    for existing or new documents. Journalling **can be disabled only** by closing
    the file.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Once enabled, every change must happen inside an *operation* – otherwise an
    exception is raised. An operation is started and stopped via document methods.
    Updates happening between these two calls form an LUW and can thus collectively
    be rolled back or re-applied, or, in MuPDF terminology “undone” resp. “redone”.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'At any point, the journalling status can be queried: whether journalling is
    active, how many operations have been recorded, whether “undo” or “redo” is possible,
    the current position inside the journal, etc.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The journal can be **saved to** or **loaded from** a file. These are document
    methods.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: When loading a journal file, compatibility with the document is checked and
    journalling is automatically enabled upon success.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'For an **existing** PDF being journalled, a special new save method is available:
    [`Document.save_snapshot()`](document.html#Document.save_snapshot "Document.save_snapshot").
    This performs a special incremental save that includes all journalled updates
    so far. If its journal is saved at the same time (immediately after the document
    snapshot), then document and journal are in sync and can later on be used together
    to undo or redo operations or to continue journalled updates – just as if there
    had been no interruption.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The snapshot PDF is a valid PDF in every aspect and fully usable. If the document
    is however changed in any way without using its journal file, then a desynchronization
    will take place and the journal is rendered unusable.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Snapshot files are structured like incremental updates. Nevertheless, the internal
    journalling logic requires, that saving **must happen to a new file**. So the
    user should develop a file naming convention to support recognizable relationships
    between an original PDF, like `original.pdf` and its snapshot sets, like `original-snap1.pdf`
    / `original-snap1.log`, `original-snap2.pdf` / `original-snap2.log`, etc.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Example Session 1
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Description:'
  prefs: []
  type: TYPE_NORMAL
- en: Make a new PDF and enable journalling. Then add a page and some text lines –
    each as a separate operation.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Navigate within the journal, undoing and redoing these updates and displaying
    status and file results:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Example Session 2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Description:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Similar to previous, but after undoing some operations, we now add a different
    update. This will cause:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: permanent removal of the undone journal entries
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: the new update operation will become the new last entry.
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_PRE
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_PRE
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_PRE
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_PRE
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_PRE
- en: Do you have any feedback on this page?
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: This software is provided AS-IS with no warranty, either express or implied.
    This software is distributed under license and may not be copied, modified or
    distributed except as expressly authorized under the terms of that license. Refer
    to licensing information at [artifex.com](https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link)
    or contact Artifex Software Inc., 39 Mesa Street, Suite 108A, San Francisco CA
    94129, United States for further information.
  prefs: []
  type: TYPE_NORMAL
- en: This documentation covers all versions up to 1.24.4.
  prefs: []
  type: TYPE_NORMAL
- en: '[![Discord logo](../Images/66cbb5081103a580193aa66c87b90d9a.png)](https://discord.gg/TSpYGBW4eq)'
  prefs: []
  type: TYPE_NORMAL
- en: Example Session 1
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Description:'
  prefs: []
  type: TYPE_NORMAL
- en: Make a new PDF and enable journalling. Then add a page and some text lines –
    each as a separate operation.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Navigate within the journal, undoing and redoing these updates and displaying
    status and file results:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Example Session 2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Description:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Similar to previous, but after undoing some operations, we now add a different
    update. This will cause:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: permanent removal of the undone journal entries
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: the new update operation will become the new last entry.
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_UL
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  - PREF_IND
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_PRE
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_PRE
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_PRE
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_PRE
- en: ''
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs:
  - PREF_IND
  - PREF_BQ
  type: TYPE_PRE
- en: Do you have any feedback on this page?
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: This software is provided AS-IS with no warranty, either express or implied.
    This software is distributed under license and may not be copied, modified or
    distributed except as expressly authorized under the terms of that license. Refer
    to licensing information at [artifex.com](https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link)
    or contact Artifex Software Inc., 39 Mesa Street, Suite 108A, San Francisco CA
    94129, United States for further information.
  prefs: []
  type: TYPE_NORMAL
- en: This documentation covers all versions up to 1.24.4.
  prefs: []
  type: TYPE_NORMAL
- en: '[![Discord logo](../Images/66cbb5081103a580193aa66c87b90d9a.png)](https://discord.gg/TSpYGBW4eq)'
  prefs: []
  type: TYPE_NORMAL
