- en: Rank promotion warning
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[`jax.readthedocs.io/en/latest/rank_promotion_warning.html`](https://jax.readthedocs.io/en/latest/rank_promotion_warning.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[NumPy broadcasting rules](https://docs.scipy.org/doc/numpy/user/basics.broadcasting.html#general-broadcasting-rules)
    allow the automatic promotion of arguments from one rank (number of array axes)
    to another. This behavior can be convenient when intended but can also lead to
    surprising bugs where a silent rank promotion masks an underlying shape error.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Here’s an example of rank promotion:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: To avoid potential surprises, `jax.numpy` is configurable so that expressions
    requiring rank promotion can lead to a warning, error, or can be allowed just
    like regular NumPy. The configuration option is named `jax_numpy_rank_promotion`
    and it can take on string values `allow`, `warn`, and `raise`. The default setting
    is `allow`, which allows rank promotion without warning or error. The `raise`
    setting raises an error on rank promotion, and `warn` raises a warning on the
    first occurrence of rank promotion.
  prefs: []
  type: TYPE_NORMAL
- en: 'Rank promotion can be enabled or disabled locally with the `jax.numpy_rank_promotion()`
    context manager:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'This configuration can also be set globally in several ways. One is by using
    `jax.config` in your code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: You can also set the option using the environment variable `JAX_NUMPY_RANK_PROMOTION`,
    for example as `JAX_NUMPY_RANK_PROMOTION='warn'`. Finally, when using `absl-py`
    the option can be set with a command-line flag.
  prefs: []
  type: TYPE_NORMAL
