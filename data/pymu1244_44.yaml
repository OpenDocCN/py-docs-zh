- en: Story
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Story
- en: 原文：[https://pymupdf.readthedocs.io/en/latest/story-class.html](https://pymupdf.readthedocs.io/en/latest/story-class.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://pymupdf.readthedocs.io/en/latest/story-class.html](https://pymupdf.readthedocs.io/en/latest/story-class.html)
- en: '*   New in v1.21.0'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '*   v1.21.0 新增'
- en: '| **Method / Attribute** | **Short Description** |'
  id: totrans-3
  prefs: []
  type: TYPE_TB
  zh: '| **方法 / 属性** | **简短描述** |'
- en: '| --- | --- |'
  id: totrans-4
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| [`Story.reset()`](#Story.reset "Story.reset") | “rewind” story output to
    its beginning |'
  id: totrans-5
  prefs: []
  type: TYPE_TB
  zh: '| [`Story.reset()`](#Story.reset "Story.reset") | 将故事输出“倒带”到其开头 |'
- en: '| [`Story.place()`](#Story.place "Story.place") | compute story content to
    fit in provided rectangle |'
  id: totrans-6
  prefs: []
  type: TYPE_TB
  zh: '| [`Story.place()`](#Story.place "Story.place") | 计算故事内容以适应提供的矩形 |'
- en: '| [`Story.draw()`](#Story.draw "Story.draw") | write the computed content to
    current page |'
  id: totrans-7
  prefs: []
  type: TYPE_TB
  zh: '| [`Story.draw()`](#Story.draw "Story.draw") | 将计算出的内容写入当前页面 |'
- en: '| [`Story.element_positions()`](#Story.element_positions "Story.element_positions")
    | callback function logging currently processed story content |'
  id: totrans-8
  prefs: []
  type: TYPE_TB
  zh: '| [`Story.element_positions()`](#Story.element_positions "Story.element_positions")
    | 回调函数，记录当前处理的故事内容 |'
- en: '| [`Story.body`](#Story.body "Story.body") | the story’s underlying *body*
    |'
  id: totrans-9
  prefs: []
  type: TYPE_TB
  zh: '| [`Story.body`](#Story.body "Story.body") | 故事的基础*body* |'
- en: '| [`Story.write()`](#Story.write "Story.write") | places and draws Story to
    a DocumentWriter |'
  id: totrans-10
  prefs: []
  type: TYPE_TB
  zh: '| [`Story.write()`](#Story.write "Story.write") | 将故事放置并绘制到 DocumentWriter
    中 |'
- en: '| [`Story.write_stabilized()`](#Story.write_stabilized "Story.write_stabilized")
    | iterative layout of html content to a DocumentWriter |'
  id: totrans-11
  prefs: []
  type: TYPE_TB
  zh: '| [`Story.write_stabilized()`](#Story.write_stabilized "Story.write_stabilized")
    | 将 HTML 内容按迭代方式布局到 DocumentWriter 中 |'
- en: '| [`Story.write_with_links()`](#Story.write_with_links "Story.write_with_links")
    | like [`write()`](#Story.write "Story.write") but also creates PDF links |'
  id: totrans-12
  prefs: []
  type: TYPE_TB
  zh: '| [`Story.write_with_links()`](#Story.write_with_links "Story.write_with_links")
    | 类似于 [`write()`](#Story.write "Story.write")，但还创建 PDF 链接 |'
- en: '| [`Story.write_stabilized_with_links()`](#Story.write_stabilized_with_links
    "Story.write_stabilized_with_links") | like [`write_stabilized()`](#Story.write_stabilized
    "Story.write_stabilized") but also creates PDF links |'
  id: totrans-13
  prefs: []
  type: TYPE_TB
  zh: '| [`Story.write_stabilized_with_links()`](#Story.write_stabilized_with_links
    "Story.write_stabilized_with_links") | 类似于 [`write_stabilized()`](#Story.write_stabilized
    "Story.write_stabilized")，但还创建 PDF 链接 |'
- en: '| [`Story.fit()`](#Story.fit "Story.fit") | Finds optimal rect that contains
    the story `self`. |'
  id: totrans-14
  prefs: []
  type: TYPE_TB
  zh: '| [`Story.fit()`](#Story.fit "Story.fit") | 找到包含故事 `self` 的最佳矩形。'
- en: '| [`Story.fit_scale()`](#Story.fit_scale "Story.fit_scale") |  |'
  id: totrans-15
  prefs: []
  type: TYPE_TB
  zh: '| [`Story.fit_scale()`](#Story.fit_scale "Story.fit_scale") |  |'
- en: '| [`Story.fit_height()`](#Story.fit_height "Story.fit_height") |  |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '| [`Story.fit_height()`](#Story.fit_height "Story.fit_height") |  |'
- en: '| [`Story.fit_width()`](#Story.fit_width "Story.fit_width") |  |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| [`Story.fit_width()`](#Story.fit_width "Story.fit_width") |  |'
- en: '**Class API**'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '**类 API**'
- en: '[PRE0]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '[PRE1]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Create a **story**, optionally providing HTML and CSS source. The HTML is parsed,
    and held within the Story as a DOM (Document Object Model).
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个**故事**，可选择提供 HTML 和 CSS 源码。HTML 被解析，并作为 DOM（文档对象模型）保存在故事中。
- en: 'This structure may be modified: content (text, images) may be added, copied,
    modified or removed by using methods of the [Xml](xml-class.html#xml) class.'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过 [Xml](xml-class.html#xml) 类的方法添加、复制、修改或删除内容（文本、图像）。此结构可能会被修改。
- en: When finished, the **story** can be written to any device; in typical usage
    the device may be provided by a [DocumentWriter](document-writer-class.html#documentwriter)
    to make new pages.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，**故事**可以写入任何设备；在典型用法中，设备可能由 [DocumentWriter](document-writer-class.html#documentwriter)
    提供以创建新页面。
- en: 'Here are some general remarks:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一些一般性的备注：
- en: The [Story](#story) constructor parses and validates the provided HTML to create
    the DOM.
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[Story](#story) 构造函数解析和验证提供的 HTML 以创建 DOM。'
- en: PyMuPDF provides a number of ways to manipulate the HTML source by providing
    access to the *nodes* of the underlying DOM. Documents can be completely built
    from ground up programmatically, or the existing DOM can be modified pretty arbitrarily.
    For details of this interface, please see the [Xml](xml-class.html#xml) class.
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PyMuPDF 提供了多种方式来通过提供对底层 DOM 的节点访问来操作 HTML 源码。文档可以完全以编程方式从头开始构建，或者现有的 DOM 可以被任意修改。有关此接口的详细信息，请参阅
    [Xml](xml-class.html#xml) 类。
- en: If no (or no more) changes to the DOM are required, the story is ready to be
    laid out and to be fed to a series of devices (typically devices provided by a
    [DocumentWriter](document-writer-class.html#documentwriter) to produce new pages).
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果不需要（或不再需要）对 DOM 进行更改，则故事已准备好进行布局，并传递给一系列设备（通常由 [DocumentWriter](document-writer-class.html#documentwriter)
    提供的设备）以生成新页面。
- en: The next step is to place the story and write it out. This can either be done
    directly, by looping around calling [`place()`](#Story.place "Story.place") and
    [`draw()`](#Story.draw "Story.draw"), or alternatively, the looping can handled
    for you using the [`write()`](#Story.write "Story.write") or `write_stabilised()`
    methods. Which method you choose is largely a matter of taste.
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 下一步是放置故事并将其写出。这可以直接完成，通过循环调用[`place()`](#Story.place "Story.place")和[`draw()`](#Story.draw
    "Story.draw")，或者可以选择使用[`write()`](#Story.write "Story.write")或`write_stabilised()`方法来处理循环。选择哪种方法主要是个人口味的问题。
- en: 'To work in the first of these styles, the following loop should be used:'
  id: totrans-29
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要使用这些样式中的第一个进行工作，应使用以下循环：
- en: Obtain a suitable device to write to; typically by requesting a new, empty page
    from a [DocumentWriter](document-writer-class.html#documentwriter).
  id: totrans-30
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获得一个适合的设备以进行写作；通常通过从[DocumentWriter](document-writer-class.html#documentwriter)请求一个新的空白页面来完成。
- en: Determine one or more rectangles on the page, that should receive **story**
    data. Note that not every page needs to have the same set of rectangles.
  id: totrans-31
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确定页面上应该接收**故事**数据的一个或多个矩形。请注意，不是每一页都需要具有相同的矩形集。
- en: Pass each rectangle to the **story** to place it, learning what part of that
    rectangle has been filled, and whether there is more story data that did not fit.
    This step can be repeated several times with adjusted rectangles until the caller
    is happy with the results.
  id: totrans-32
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将每个矩形传递给**故事**以放置它，学习该矩形的哪一部分已填充，以及是否有更多未适应的故事数据。此步骤可以重复多次，直到调用者对结果满意。
- en: Optionally, at this point, we can request details of where interesting items
    have been placed, by calling the [`element_positions()`](#Story.element_positions
    "Story.element_positions") method. Items are deemed to be interesting if their
    integer `heading` attribute is a non-zero (corresponding to HTML tags *h1* - *h6*),
    if their `id` attribute is not `None` (corresponding to HTML tag *id*), or if
    their `href` attribute is not `None` (responding to HTML tag *href*). This can
    conveniently be used for automatic generation of a Table of Contents, an index
    of images or the like.
  id: totrans-33
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 可选地，在这一点上，我们可以通过调用[`element_positions()`](#Story.element_positions "Story.element_positions")方法来请求放置有趣项目的详细信息。如果其整数`heading`属性为非零（对应HTML标签*h1*
    - *h6*），如果其`id`属性不为`None`（对应HTML标签*id*），或者如果其`href`属性不为`None`（对应HTML标签*href*），则项目被视为有趣项目。这可以方便地用于自动生成目录、图像索引或类似内容。
- en: Next, draw that rectangle out to the device with the [`draw()`](#Story.draw
    "Story.draw") method.
  id: totrans-34
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，用[`draw()`](#Story.draw "Story.draw")方法将该矩形绘制到设备上。
- en: If the most recent call to [`place()`](#Story.place "Story.place") indicated
    that all the story data had fitted, stop now.
  id: totrans-35
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果最近的一次调用[`place()`](#Story.place "Story.place")表明所有故事数据已经适应，现在停止。
- en: Otherwise, we can loop back. If there are more rectangles to be placed on the
    current device (page), we jump back to step 3 - if not, we jump back to step 1
    to get a new device.
  id: totrans-36
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 否则，我们可以回到循环。如果有更多矩形要放置在当前设备（页面）上，我们回到步骤3 - 如果没有，我们回到步骤1获取一个新设备。
- en: Alternatively, in the case where you are using a [DocumentWriter](document-writer-class.html#documentwriter),
    the [`write()`](#Story.write "Story.write") or [`write_stabilized()`](#Story.write_stabilized
    "Story.write_stabilized") methods can be used. These handle all the looping for
    you, in exchange for being provided with callbacks that control the behaviour
    (notably a callback that enumerates the rectangles/pages to use).
  id: totrans-37
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 或者，在使用[DocumentWriter](document-writer-class.html#documentwriter)的情况下，可以使用[`write()`](#Story.write
    "Story.write")或[`write_stabilized()`](#Story.write_stabilized "Story.write_stabilized")方法。这些方法为您处理所有循环，但需要提供控制行为的回调（特别是枚举要使用的矩形/页面的回调）。
- en: Which part of the **story** will land on which rectangle / which page, is fully
    under control of the [Story](#story) object and cannot be predicted.
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**故事**的哪一部分将落在哪个矩形/哪一页完全由[Story](#story)对象控制，无法预测。'
- en: Images may be part of a **story**. They will be placed together with any surrounding
    text.
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 图像可能是**故事**的一部分。它们将与周围的文本一起放置。
- en: Multiple stories may - independently from each other - write to the same page.
    For example, one may have separate stories for page header, page footer, regular
    text, comment boxes, etc.
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多个故事可能 - 互不干扰地 - 写入同一页。例如，页面页眉、页脚、常规文本、评论框等可能有单独的故事。
- en: 'Parameters:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 参数：
- en: '**html** (*str*) – HTML source code. If omitted, a basic minimum is generated
    (see below). If provided, not a complete HTML document is needed. The in-built
    source parser will forgive (many / most) HTML syntax errors and also accepts HTML
    fragments like `"<b>Hello, <i>World!</i></b>"`.'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**html** (*str*) – HTML源代码。如果省略，将生成基本的最小内容（见下文）。如果提供，则不需要完整的HTML文档。内置源解析器将容忍（许多/大多数）HTML语法错误，并且还接受HTML片段，例如
    `"<b>Hello, <i>World!</i></b>"`。'
- en: '**user_css** (*str*) – CSS source code. If provided, must contain valid CSS
    specifications.'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**user_css** (*str*) – CSS源代码。如果提供，必须包含有效的CSS规范。'
- en: '**em** (*float*) – the default text font size.'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**em** (*float*) – 默认文本字体大小。'
- en: '**archive** –'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**archive** –'
- en: an [Archive](archive-class.html#archive) from which to load resources for rendering.
    Currently supported resource types are images and text fonts. If omitted, the
    story will not try to look up any such data and may thus produce incomplete output.
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 从中加载资源以进行渲染的[Archive](archive-class.html#archive)。当前支持的资源类型为图像和文本字体。如果省略，则故事将不会尝试查找任何此类数据，因此可能会产生不完整的输出。
- en: Note
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Note
- en: Instead of an actual archive, valid arguments for **creating** an [Archive](archive-class.html#archive)
    can also be provided – in which case an archive will temporarily be constructed.
    So, instead of `story = pymupdf.Story(archive=pymupdf.Archive("myfolder"))`, one
    can also shorter write `story = pymupdf.Story(archive="myfolder")`.
  id: totrans-48
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Instead of an actual archive, valid arguments for **creating** an [Archive](archive-class.html#archive)
    can also be provided – in which case an archive will temporarily be constructed.
    So, instead of `story = pymupdf.Story(archive=pymupdf.Archive("myfolder"))`, one
    can also shorter write `story = pymupdf.Story(archive="myfolder")`.
- en: '[PRE2]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Calculate that part of the story’s content, that will fit in the provided rectangle.
    The method maintains a pointer which part of the story’s content has already been
    written and upon the next invocation resumes from that pointer’s position.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 计算故事内容的那部分，适合于提供的矩形内。该方法维护一个指针，指示已写入故事内容的哪一部分，并在下次调用时从该指针位置恢复。
- en: 'Parameters:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 'Parameters:'
- en: '**where** (*rect_like*) – layout the current part of the content to fit into
    this rectangle. This must be a sub-rectangle of the page’s [MediaBox](glossary.html#glossary-mediabox).'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '**where** (*rect_like*) – 布局当前内容部分以适应此矩形。这必须是页面[MediaBox](glossary.html#glossary-mediabox)的子矩形。'
- en: 'Return type:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 'Return type:'
- en: tuple[bool, rect_like]
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: tuple[bool, rect_like]
- en: 'Returns:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 'Returns:'
- en: a bool (int) `more` and a rectangle `filled`. If `more == 0`, all content of
    the story has been written, otherwise more is waiting to be written to subsequent
    rectangles / pages. Rectangle `filled` is the part of `where` that has actually
    been filled.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 一个布尔值（int）`more` 和一个矩形 `filled`。如果 `more == 0`，则所有故事内容均已写入，否则还有待写入后续矩形/页面。矩形
    `filled` 是实际填充的 `where` 部分。
- en: '[PRE3]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Write the content part prepared by [`Story.place()`](#Story.place "Story.place")
    to the page.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 将由[`Story.place()`](#Story.place "Story.place")准备的内容部分写入页面。
- en: 'Parameters:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 'Parameters:'
- en: '**dev** – the [Device](device.html#device) created by `dev = writer.begin_page(mediabox)`.
    The device knows how to call all MuPDF functions needed to write the content.'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**dev** – 由 `dev = writer.begin_page(mediabox)` 创建的[Device](device.html#device)。该设备知道如何调用所有写入内容所需的MuPDF函数。'
- en: '**matrix** (*matrix_like*) – a matrix for transforming content when writing
    to the page. An example may be writing rotated text. The default means no transformation
    (i.e. the [Identity](identity.html#identity) matrix).'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**matrix** (*matrix_like*) – 用于在写入页面时转换内容的矩阵。例如，可以写入旋转文本的示例。默认情况下不进行转换（即[Identity](identity.html#identity)矩阵）。'
- en: '[PRE4]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Let the Story provide positioning information about certain HTML elements once
    their place on the current page has been computed - i.e. invoke this method **directly
    after** [`Story.place()`](#Story.place "Story.place").
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 让Story在计算出当前页面上某些HTML元素的位置后提供位置信息 - 即在[`Story.place()`](#Story.place "Story.place")之后**直接调用**此方法。
- en: '*Story* will pass position information to *function*. This information can
    for example be used to generate a Table of Contents.'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: '*Story*将位置信息传递给*function*。例如，这些信息可用于生成目录。'
- en: 'Parameters:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 'Parameters:'
- en: '**function** (*callable*) – a Python function accepting an `ElementPosition`
    object. It will be invoked by the Story object to process positioning information.
    The function **must** be a callable accepting exactly one argument.'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**function** (*callable*) – 一个接受`ElementPosition`对象的Python函数。它将由Story对象调用以处理位置信息。此函数**必须**是一个接受正好一个参数的可调用对象。'
- en: '**args** (*dict*) – an optional dictionary with any **additional** information
    that should be added to the `ElementPosition` instance passed to `function`. Like
    for example the current output page number. Every key in this dictionary must
    be a string that conforms to the rules for a valid Python identifier. The complete
    set of information is explained below.'
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**args** (*dict*) – 一个可选的字典，包含应该添加到传递给`function`的`ElementPosition`实例的任何**附加**信息。例如，当前输出页码。该字典中的每个键必须是符合有效Python标识符规则的字符串。所有信息的完整集合将在下面解释。'
- en: '[PRE5]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Rewind the story’s document to the beginning for starting over its output.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 将故事文档倒回到开始以重新开始其输出。
- en: '[PRE6]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The *body* part of the story’s DOM. This attribute contains the [Xml](xml-class.html#xml)
    node of *body*. All relevant content for PDF production is contained between “<body>”
    and “</body>”.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 故事DOM的*body*部分。此属性包含PDF制作的所有相关内容，位于“<body>”和“</body>”之间的[Xml](xml-class.html#xml)节点。
- en: '[PRE7]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Places and draws Story to a [DocumentWriter](document-writer-class.html#documentwriter).
    Avoids the need for calling code to implement a loop that calls [`Story.place()`](#Story.place
    "Story.place") and [`Story.draw()`](#Story.draw "Story.draw") etc, at the expense
    of having to provide at least the `rectfn()` callback.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 将Story放置并绘制到[DocumentWriter](document-writer-class.html#documentwriter)。避免调用代码实现调用[`Story.place()`](#Story.place
    "Story.place")和[`Story.draw()`](#Story.draw "Story.draw")等循环的需要，代价是至少要提供`rectfn()`回调函数。
- en: 'Parameters:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 参数：
- en: '**writer** – a [DocumentWriter](document-writer-class.html#documentwriter)
    or None.'
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**writer** – 一个[DocumentWriter](document-writer-class.html#documentwriter)，或者为None。'
- en: '**rectfn** –'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**rectfn** –'
- en: 'a callable taking `(rect_num: int, filled: Rect)` and returning `(mediabox,
    rect, ctm)`:'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '一个可调用的函数，接受`(rect_num: int, filled: Rect)`并返回`(mediabox, rect, ctm)`：'
- en: 'mediabox: None or rect for new page.'
  id: totrans-78
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: mediabox：None或新页面的矩形。
- en: 'rect: The next rect into which content should be placed.'
  id: totrans-79
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: rect：下一个放置内容的矩形。
- en: 'ctm: None or a [Matrix](matrix.html#matrix).'
  id: totrans-80
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: ctm：None或者一个[Matrix](matrix.html#matrix)。
- en: '**positionfn** –'
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**positionfn** –'
- en: 'None, or a callable taking `(position: ElementPosition)`:'
  id: totrans-82
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 'None，或者一个接受`(position: ElementPosition)`的可调用函数：'
- en: 'position:'
  id: totrans-83
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 位置：
- en: An `ElementPosition` with an extra `.page_num` member.
  id: totrans-84
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: 一个带有额外的`.page_num`成员的`ElementPosition`。
- en: Typically called multiple times as we generate elements that are headings or
    have an id.
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 通常作为生成具有标题或ID的元素的多次调用。
- en: '**pagefn** – None, or a callable taking `(page_num, mediabox, dev, after)`;
    called at start (`after=0`) and end (`after=1`) of each page.'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**pagefn** – None，或者一个接受`(page_num, mediabox, dev, after)`的可调用函数；在每页的开始（`after=0`）和结束（`after=1`）时调用。'
- en: '[PRE8]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Static method that does iterative layout of html content to a [DocumentWriter](document-writer-class.html#documentwriter).
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 执行HTML内容的迭代布局到[DocumentWriter](document-writer-class.html#documentwriter)的静态方法。
- en: For example this allows one to add a table of contents section while ensuring
    that page numbers are patched up until stable.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，这允许在确保页码稳定之前添加目录部分。
- en: Repeatedly creates a new [Story](#story) from `(contentfn(), user_css, em, archive)`
    and lays it out with internal call to [`Story.write()`](#Story.write "Story.write");
    uses a None writer and extracts the list of `ElementPosition`’s which is passed
    to the next call of `contentfn()`.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 从`(contentfn(), user_css, em, archive)`创建一个新的[Story](#story)并使用内部调用[`Story.write()`](#Story.write
    "Story.write")布局它；使用None writer并提取传递给下一个`contentfn()`调用的`ElementPosition`列表。
- en: When the html from `contentfn()` becomes unchanged, we do a final iteration
    using `writer`.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 当`contentfn()`的HTML变化不再变化时，我们使用`writer`进行最终迭代。
- en: 'Parameters:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 参数：
- en: '**writer** – A [DocumentWriter](document-writer-class.html#documentwriter).'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**writer** – 一个[DocumentWriter](document-writer-class.html#documentwriter)。'
- en: '**contentfn** – A function taking a list of `ElementPositions` and returning
    a string containing html. The returned html can depend on the list of positions,
    for example with a table of contents near the start.'
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**contentfn** – 接受`ElementPosition`列表并返回包含HTML的字符串的函数。返回的HTML可以依赖于位置列表，例如在开头附近有目录。'
- en: '**rectfn** –'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**rectfn** –'
- en: 'A callable taking `(rect_num: int, filled: Rect)` and returning `(mediabox,
    rect, ctm)`:'
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '一个可调用的函数，接受`(rect_num: int, filled: Rect)`并返回`(mediabox, rect, ctm)`：'
- en: 'mediabox: None or rect for new page.'
  id: totrans-97
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: mediabox：None或新页面的矩形。
- en: 'rect: The next rect into which content should be placed.'
  id: totrans-98
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: rect：下一个放置内容的矩形。
- en: 'ctm: A [Matrix](matrix.html#matrix).'
  id: totrans-99
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: ctm：一个[Matrix](matrix.html#matrix)。
- en: '**pagefn** – None, or a callable taking `(page_num, medibox, dev, after)`;
    called at start (`after=0`) and end (`after=1`) of each page.'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**pagefn** – None，或者一个接受`(page_num, medibox, dev, after)`的可调用函数；在每页的开始（`after=0`）和结束（`after=1`）时调用。'
- en: '**archive** –'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**archive** –'
- en: '**add_header_ids** – If true, we add unique ids to all header tags that don’t
    already have an id. This can help automatic generation of tables of contents.'
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**add_header_ids** – 如果为真，我们为所有尚未具有ID的标题标签添加唯一的ID。这有助于自动生成目录。'
- en: 'Returns:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 返回：
- en: None.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 无。
- en: '[PRE9]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Similar to [`write()`](#Story.write "Story.write") except that we don’t have
    a `writer` arg and we return a PDF [Document](document.html#document) in which
    links have been created for each internal html link.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 类似于[`write()`](#Story.write "Story.write")，但我们没有`writer`参数，返回一个PDF [文档](document.html#document)，其中为每个内部HTML链接创建了链接。
- en: '[PRE10]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Similar to [`write_stabilized()`](#Story.write_stabilized "Story.write_stabilized")
    except that we don’t have a `writer` arg and instead return a PDF [Document](document.html#document)
    in which links have been created for each internal html link.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 类似于[`write_stabilized()`](#Story.write_stabilized "Story.write_stabilized")，但我们没有`writer`参数，而是返回一个PDF
    [文档](document.html#document)，其中为每个内部HTML链接创建了链接。
- en: '[PRE11]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: The result from a `Story.fit*()` method.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 来自`Story.fit*()`方法的结果。
- en: 'Members:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 成员：
- en: '`big_enough`:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '`big_enough`：'
- en: '`True` if the fit succeeded.'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '`True`如果适合成功。'
- en: '`filled`:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '`filled`：'
- en: From the last call to [`Story.place()`](#Story.place "Story.place").
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 从上一次调用[`Story.place()`](#Story.place "Story.place")。
- en: '`more`:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '`more`：'
- en: '`False` if the fit succeeded.'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '`False`如果适合成功。'
- en: '`numcalls`:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: '`numcalls`：'
- en: Number of calls made to `self.place()`.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 调用`self.place()`的次数。
- en: '`parameter`:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '`parameter`：'
- en: The successful parameter value, or the largest failing value.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 成功的参数值，或最大的失败值。
- en: '[Rect](rect.html):'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '[Rect](rect.html):'
- en: The rect created from `parameter`.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 从`parameter`创建的rect。
- en: '[PRE12]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Finds optimal rect that contains the story `self`.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 找到包含故事`self`的最佳rect。
- en: Returns a [`Story.FitResult`](#Story.FitResult "Story.FitResult") instance.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 返回一个[`Story.FitResult`](#Story.FitResult "Story.FitResult") 实例。
- en: On success, the last call to `self.place()` will have been with the returned
    rectangle, so `self.draw()` can be used directly.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 成功时，最后一次调用`self.place()`将使用返回的矩形，因此可以直接使用`self.draw()`。
- en: 'Parameters:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 参数：
- en: '**fn** –'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**fn** –'
- en: A callable taking a floating point `parameter` and returning a `pymupdf.Rect()`.
    If the rect is empty, we assume the story will not fit and do not call `self.place()`.
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 一个可调用对象，接受一个浮点`parameter`并返回一个`pymupdf.Rect()`。如果rect为空，我们假设故事不会适合，并且不调用`self.place()`。
- en: Must guarantee that `self.place()` behaves monotonically when given rect `fn(parameter`)
    as `parameter` increases. This usually means that both width and height increase
    or stay unchanged as `parameter` increases.
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 必须确保当给定rect `fn(parameter`)作为`parameter`增加时，`self.place()`行为单调递增。通常情况下，随着`parameter`增加，宽度和高度都会增加或保持不变。
- en: '**pmin** – Minimum parameter to consider; `None` for -infinity.'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**pmin** – 要考虑的最小参数；`None`表示负无穷。'
- en: '**pmax** – Maximum parameter to consider; `None` for +infinity.'
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**pmax** – 要考虑的最大参数；`None`表示正无穷。'
- en: '**delta** – Maximum error in returned `parameter`.'
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**delta** – 返回的`parameter`的最大误差。'
- en: '**verbose** – If true we output diagnostics.'
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**verbose** – 如果为真，我们输出诊断信息。'
- en: '[PRE13]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Finds smallest value `scale` in range `scale_min..scale_max` where `scale *
    rect` is large enough to contain the story `self`.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 在范围`scale_min..scale_max`中找到一个比例`scale`，其中`scale * rect`足够大以容纳故事`self`。
- en: Returns a [`Story.FitResult`](#Story.FitResult "Story.FitResult") instance.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 返回一个[`Story.FitResult`](#Story.FitResult "Story.FitResult") 实例。
- en: 'Parameters:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 参数：
- en: '**width** – width of rect.'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**width** – rect的宽度。'
- en: '**height** – height of rect.'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**height** – rect的高度。'
- en: '**scale_min** – Minimum scale to consider; must be >= 0.'
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**scale_min** – 要考虑的最小比例，必须>= 0。'
- en: '**scale_max** – Maximum scale to consider, must be >= scale_min or `None` for
    infinite.'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**scale_max** – 要考虑的最大比例，必须>= scale_min或`None`表示无限。'
- en: '**delta** – Maximum error in returned scale.'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**delta** – 返回的比例的最大误差。'
- en: '**verbose** – If true we output diagnostics.'
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**verbose** – 如果为真，我们输出诊断信息。'
- en: '[PRE14]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Finds smallest height in range `height_min..height_max` where a rect with size
    `(width, height)` is large enough to contain the story `self`.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 在范围`height_min..height_max`中找到一个rect的最小高度，其中一个大小为`(width, height)`的rect足够大以包含故事`self`。
- en: Returns a [`Story.FitResult`](#Story.FitResult "Story.FitResult") instance.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 返回一个[`Story.FitResult`](#Story.FitResult "Story.FitResult") 实例。
- en: 'Parameters:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 参数：
- en: '**width** – width of rect.'
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**width** – rect的宽度。'
- en: '**height_min** – Minimum height to consider; must be >= 0.'
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**height_min** – 要考虑的最小高度；必须>= 0。'
- en: '**height_max** – Maximum height to consider, must be >= height_min or `None`
    for infinite.'
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**height_max** – 考虑的最大高度，必须>= height_min或`None`表示无限。'
- en: '**origin** – `(x0, y0)` of rect.'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**origin** – rect的`(x0, y0)`。'
- en: '**delta** – Maximum error in returned height.'
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**delta** – 返回的高度的最大误差。'
- en: '**verbose** – If true we output diagnostics.'
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**verbose** – 如果为真，我们输出诊断信息。'
- en: '[PRE15]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Finds smallest width in range `width_min..width_max` where a rect with size
    `(width, height)` is large enough to contain the story `self`.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 查找在范围`width_min..width_max`内最小的宽度，在该宽度下矩形大小为`(width, height)`足够大以包含故事`self`。
- en: Returns a [`Story.FitResult`](#Story.FitResult "Story.FitResult") instance.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 返回[`Story.FitResult`](#Story.FitResult "Story.FitResult")实例。
- en: 'Parameters:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 参数：
- en: '**height** – height of rect.'
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**height** – 矩形的高度。'
- en: '**width_min** – Minimum width to consider; must be >= 0.'
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**width_min** – 要考虑的最小宽度；必须 >= 0。'
- en: '**width_max** – Maximum width to consider, must be >= width_min or `None` for
    infinite.'
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**width_max** – 要考虑的最大宽度；必须 >= width_min 或者`None`表示无限宽度。'
- en: '**origin** – `(x0, y0)` of rect.'
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**origin** – 矩形的`(x0, y0)`坐标。'
- en: '**delta** – Maximum error in returned width.'
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**delta** – 返回宽度的最大误差。'
- en: '**verbose** – If true we output diagnostics.'
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**verbose** – 如果为true，则输出诊断信息。'
- en: Element Positioning CallBack function
  id: totrans-166
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 元素定位回调函数
- en: 'The callback function can be used to log information about story output. The
    function’s access to the information is read-only: it has no way to influence
    the story’s output.'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 回调函数可用于记录关于故事输出的信息。该函数对信息的访问是只读的：它无法影响故事的输出。
- en: 'A typical loop for executing a story with using this method would look like
    this:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此方法执行故事的典型循环如下所示：
- en: '[PRE16]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Attributes of the ElementPosition class
  id: totrans-170
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ElementPosition类的属性
- en: 'Exactly one parameter must be passed to the function provided by [`Story.element_positions()`](#Story.element_positions
    "Story.element_positions"). It is an object with the following attributes:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 必须向[`Story.element_positions()`](#Story.element_positions "Story.element_positions")提供的函数传递一个参数。它是一个具有以下属性的对象：
- en: 'The parameter passed to the `recorder` function is an object with the following
    attributes:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 传递给`recorder`函数的参数是一个具有以下属性的对象：
- en: '`elpos.depth` (int) – depth of this element in the box structure.'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.depth` (int) – 箱结构中此元素的深度。'
- en: '`elpos.heading` (int) – the header level, 0 if no header, 1-6 for *h1* - *h6*.'
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.heading` (int) – 标题级别，如果没有标题则为0，对应*h1*至*h6*的1至6。'
- en: '`elpos.href` (str) – value of the `href` attribute, or None if not defined.'
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.href` (str) – `href`属性的值，如果未定义则为None。'
- en: '`elpos.id` (str) – value of the `id` attribute, or None if not defined.'
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.id` (str) – `id`属性的值，如果未定义则为None。'
- en: '`elpos.rect` (tuple) – element position on page.'
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.rect` (tuple) – 页面上元素的位置。'
- en: '`elpos.text` (str) – immediate text of the element.'
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.text` (str) – 元素的即时文本。'
- en: '`elpos.open_close` (int bit field) – bit 0 set: opens element, bit 1 set: closes
    element. Relevant for elements that may contain other elements and thus may not
    immediately be closed after being created / opened.'
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.open_close` (int 位字段) – 比特0设置：打开元素，比特1设置：关闭元素。适用于可能包含其他元素并因此创建/打开后可能不会立即关闭的元素。'
- en: '`elpos.rect_num` (int) – count of rectangles filled by the story so far.'
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.rect_num` (int) – 到目前为止故事中填充的矩形数量。'
- en: '`elpos.page_num` (int) – page number; only present when using `pymupdf.Story.write*()`
    functions.'
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.page_num` (int) – 页码；仅在使用`pymupdf.Story.write*()`函数时出现。'
- en: Do you have any feedback on this page?
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 您对此页面有何反馈？
- en: '* * *'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: This software is provided AS-IS with no warranty, either express or implied.
    This software is distributed under license and may not be copied, modified or
    distributed except as expressly authorized under the terms of that license. Refer
    to licensing information at [artifex.com](https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link)
    or contact Artifex Software Inc., 39 Mesa Street, Suite 108A, San Francisco CA
    94129, United States for further information.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 本软件按原样提供，不附带任何形式的明示或暗示担保。本软件按许可分发，未经授权不得复制、修改或分发。有关详细信息，请参阅[artifex.com](https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link)，或联系位于美国加利福尼亚州旧金山94129号梅萨街39号108A套房的Artifex
    Software Inc。
- en: This documentation covers all versions up to 1.24.4.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 此文档涵盖所有1.24.4版本。
- en: '[![Discord logo](../Images/66cbb5081103a580193aa66c87b90d9a.png)](https://discord.gg/TSpYGBW4eq)'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: '[![Discord logo](../Images/66cbb5081103a580193aa66c87b90d9a.png)](https://discord.gg/TSpYGBW4eq)'
- en: Element Positioning CallBack function
  id: totrans-187
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 元素定位回调函数
- en: 'The callback function can be used to log information about story output. The
    function’s access to the information is read-only: it has no way to influence
    the story’s output.'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 回调函数可用于记录关于故事输出的信息。该函数对信息的访问是只读的：它无法影响故事的输出。
- en: 'A typical loop for executing a story with using this method would look like
    this:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此方法执行故事的典型循环如下所示：
- en: '[PRE17]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Attributes of the ElementPosition class
  id: totrans-191
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ElementPosition类的属性
- en: 'Exactly one parameter must be passed to the function provided by [`Story.element_positions()`](#Story.element_positions
    "Story.element_positions"). It is an object with the following attributes:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 必须向 [`Story.element_positions()`](#Story.element_positions "Story.element_positions")
    提供的函数传递一个参数。它是具有以下属性的对象：
- en: 'The parameter passed to the `recorder` function is an object with the following
    attributes:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 传递给 `recorder` 函数的参数是具有以下属性的对象：
- en: '`elpos.depth` (int) – depth of this element in the box structure.'
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.depth`（int）- 此元素在框结构中的深度。'
- en: '`elpos.heading` (int) – the header level, 0 if no header, 1-6 for *h1* - *h6*.'
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.heading`（int）- 标题级别，如果没有标题则为 0，*h1* - *h6* 对应 1-6。'
- en: '`elpos.href` (str) – value of the `href` attribute, or None if not defined.'
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.href`（str）- `href` 属性的值，如果未定义则为 None。'
- en: '`elpos.id` (str) – value of the `id` attribute, or None if not defined.'
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.id`（str）- `id` 属性的值，如果未定义则为 None。'
- en: '`elpos.rect` (tuple) – element position on page.'
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.rect`（tuple）- 页面上的元素位置。'
- en: '`elpos.text` (str) – immediate text of the element.'
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.text`（str）- 元素的即时文本。'
- en: '`elpos.open_close` (int bit field) – bit 0 set: opens element, bit 1 set: closes
    element. Relevant for elements that may contain other elements and thus may not
    immediately be closed after being created / opened.'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.open_close`（int 位字段）- 设置位 0：打开元素，设置位 1：关闭元素。对于可能包含其他元素的元素以及因此可能在创建/打开后不会立即关闭的元素相关。'
- en: '`elpos.rect_num` (int) – count of rectangles filled by the story so far.'
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.rect_num`（int）- 故事到目前为止填充的矩形数量。'
- en: '`elpos.page_num` (int) – page number; only present when using `pymupdf.Story.write*()`
    functions.'
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.page_num`（int）- 页码；仅在使用 `pymupdf.Story.write*()` 函数时存在。'
- en: Do you have any feedback on this page?
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 在这页上有任何反馈吗？
- en: '* * *'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: This software is provided AS-IS with no warranty, either express or implied.
    This software is distributed under license and may not be copied, modified or
    distributed except as expressly authorized under the terms of that license. Refer
    to licensing information at [artifex.com](https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link)
    or contact Artifex Software Inc., 39 Mesa Street, Suite 108A, San Francisco CA
    94129, United States for further information.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 本软件按原样提供，不附带任何明示或暗示的保证。本软件在许可下分发，并且除非根据该许可明确授权，否则不得复制、修改或分发本软件。有关详细信息，请参阅 [artifex.com](https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link)
    上的许可信息，或联系 Artifex Software Inc.，39 Mesa Street，Suite 108A，San Francisco CA 94129，United
    States。
- en: This documentation covers all versions up to 1.24.4.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 此文档涵盖所有版本，直至 1.24.4。
- en: '[![Discord logo](../Images/66cbb5081103a580193aa66c87b90d9a.png)](https://discord.gg/TSpYGBW4eq)'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: '[![Discord logo](../Images/66cbb5081103a580193aa66c87b90d9a.png)](https://discord.gg/TSpYGBW4eq)'
- en: Attributes of the ElementPosition class
  id: totrans-208
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ElementPosition 类的属性
- en: 'Exactly one parameter must be passed to the function provided by [`Story.element_positions()`](#Story.element_positions
    "Story.element_positions"). It is an object with the following attributes:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 必须向 [`Story.element_positions()`](#Story.element_positions "Story.element_positions")
    提供的函数传递一个参数。它是具有以下属性的对象：
- en: 'The parameter passed to the `recorder` function is an object with the following
    attributes:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 传递给 `recorder` 函数的参数是具有以下属性的对象：
- en: '`elpos.depth` (int) – depth of this element in the box structure.'
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.depth`（int）- 此元素在框结构中的深度。'
- en: '`elpos.heading` (int) – the header level, 0 if no header, 1-6 for *h1* - *h6*.'
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.heading`（int）- 标题级别，如果没有标题则为 0，*h1* - *h6* 对应 1-6。'
- en: '`elpos.href` (str) – value of the `href` attribute, or None if not defined.'
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.href`（str）- `href` 属性的值，如果未定义则为 None。'
- en: '`elpos.id` (str) – value of the `id` attribute, or None if not defined.'
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.id`（str）- `id` 属性的值，如果未定义则为 None。'
- en: '`elpos.rect` (tuple) – element position on page.'
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.rect`（tuple）- 页面上的元素位置。'
- en: '`elpos.text` (str) – immediate text of the element.'
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.text`（str）- 元素的即时文本。'
- en: '`elpos.open_close` (int bit field) – bit 0 set: opens element, bit 1 set: closes
    element. Relevant for elements that may contain other elements and thus may not
    immediately be closed after being created / opened.'
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.open_close`（int 位字段）- 设置位 0：打开元素，设置位 1：关闭元素。对于可能包含其他元素的元素以及因此可能在创建/打开后不会立即关闭的元素相关。'
- en: '`elpos.rect_num` (int) – count of rectangles filled by the story so far.'
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.rect_num`（int）- 故事到目前为止填充的矩形数量。'
- en: '`elpos.page_num` (int) – page number; only present when using `pymupdf.Story.write*()`
    functions.'
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`elpos.page_num`（int）- 页码；仅在使用 `pymupdf.Story.write*()` 函数时存在。'
- en: Do you have any feedback on this page?
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 在这页上有任何反馈吗？
- en: '* * *'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: This software is provided AS-IS with no warranty, either express or implied.
    This software is distributed under license and may not be copied, modified or
    distributed except as expressly authorized under the terms of that license. Refer
    to licensing information at [artifex.com](https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link)
    or contact Artifex Software Inc., 39 Mesa Street, Suite 108A, San Francisco CA
    94129, United States for further information.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 此软件按原样提供，不附任何明示或暗示的保证。此软件在许可下分发，未经许可明确授权，不得复制、修改或分发。请参阅[artifex.com](https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link)获取许可信息，或联系美国旧金山94129
    Mesa街39号108A套房Artifex Software Inc.以获取进一步信息。
- en: This documentation covers all versions up to 1.24.4.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 此文档覆盖所有版本直至1.24.4。
- en: '[![Discord logo](../Images/66cbb5081103a580193aa66c87b90d9a.png)](https://discord.gg/TSpYGBW4eq)'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: '[![Discord logo](../Images/66cbb5081103a580193aa66c87b90d9a.png)](https://discord.gg/TSpYGBW4eq)'
